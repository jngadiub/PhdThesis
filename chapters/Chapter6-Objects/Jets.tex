%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Jets}\label{sec:jets}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Particles carrying a color charge, such as quarks, cannot exist in free form because of QCD confinement which only allows for colorless states (\FIXME{point here to theory chapter}). Quarks and gluons interact with pairs of quarks and anti-quarks produced from the vacuum until the formation of stable colourless hadrons, the process is called hadronization. The ensemble of the final colourless objects is called a jet and it is reconstructed in the detector from energy depositions and charged particle momenta.
The jets point back to the primary interaction, i.e. to the partons the jets originated from, but a correction for hadronization and detector effects is needed. Jet clustering algorithms have been developed to cluster particles (at parton, particle or detector level) into jets and reconstruct the energy and direction of the original parton. The task of a jet clustering algorithm is to allow comparisons between theoretical predictions, which are usually described by perturbative calculations, and experimental data. This is achieved reducing the complex structure of particle jets from a scattered parton to a simple four-momentum, which represents the main property of particle jets.
In order to guarantee a meaningful calculation of theory predictions, jet clustering algorithms are characterized by two important properties.
%Two properties of jet clustering algorithms are desired to be able to calculate meaningful theory predictions.
Clustering algorithms need to be infrared-safe, which means that the emission of infinitesimally-low-energy partons from partons inside a jet does not affect the jet properties. Furthermore, they need to be collinear-safe, which means that jet properties are not affected by the splitting of a parton inside a jet into two collinear partons.
Jet algorithms for hadron colliders can be divided into two classes: cone~\cite{Salam:2007xv} and sequential clustering~\cite{Catani:1993hr,Ellis:1993tq,Dokshitzer:1997in,Wobisch:1998wt,Cacciari:2008gp} algorithms.
%Jet algorithms for hadron colliders can be divided into two classes. One possibility is based on proximity in coordinate space, cone jet algorithms [180, 181]) whereas the other uses proximity in momentum space by successively merging pairs of particles in order of increasing relative transverse momentum, kT algorithms [182, 183]). For this work only the anti-kT algorithm of the kT family is used and detailed in the following.
The main algorithms used by LHC experiments are the anti-$k_t$ algorithm~\cite{Cacciari:2008gp} (AK) and the Cambridge--Aachen (CA)~\cite{Catani:1993hr,Dokshitzer:1997in} algorithms, which are found to fulfil theory requirements and to exhibit good properties for experimental measurements. For this work both algorithms are used and described in the following.
 
 %%%%%%%% 
\subsection{Jet clustering algorithms}\label{subsec:jetsalgo}
%%%%%%%%

In sequential jet clustering algorithms, jets are defined through sequential, iterative procedures that combine four-vectors of input pairs of particles until certain criteria are satisfied and jets are formed. In particular, for each pair of particles $i$ and $j$, a distance variable between the two particles ($d_{ij}$), and the so-called ``beam distance'' for each particle ($d_{iB}$), are computed:
 
\begin{equation}
d_{ij} = \mathrm{min}(p_{Ti}^{2n},p_{Tj}^{2n})\frac{\Delta R^2{ij}}{R^2}\quad,\quad\quad\quad
d_{iB} = p_{Ti}^{2n}\quad,
\end{equation} 

where $p_{Ti}$ and $p_{Tj}$ are the transverse momenta of particles $i$ and $j$, respectively, ``min'' refers to the smaller of the two \pt values, the integer $n$ depends on the specific jet algorithm, $\Delta R^2{ij}$ is the distance between $i$ and $j$ in $\eta$ and $\phi$, and $R$ is a free distance parameter, with all angles expressed in radians. The particle pair ($i$, $j$) with smallest $d_{ij}$ is combined into a single object. All distances are recalculated using the new object, and the procedure is repeated until, for a given object $i$, all the $d_{ij}$ are greater than $d_{iB}$. Object $i$ is then classified as a jet and not considered further in the algorithm. The process is repeated until all input particles are clustered into jets.

The distance parameter $R$ is responsible for defining the angular size of the jet. The parameter $n$ governs the topological properties of the jets and depending on its value three different classes of clustering algorithms are distinguished. For $n = 1$ the procedure is referred to as the $k_t$ algorithm (KT), which clusters soft objects before harder ones are added to the final jet. The KT jets tend to have irregular shapes and are especially useful for reconstructing jets of lower momentum~\cite{Cacciari:2008gp}. For this reason, they are also sensitive to the presence of low-\pt pileup contributions.
%, and are used to compute the mean \pt per unit area of an event.
For $n = 0$, the procedure corresponds to the CA algorithm. This relies only on angular information, and, like the KT algorithm, provides irregularly-shaped jets. The CA algorithm is useful in identifying jet substructure as described in Chapter~\ref{ch:vtagging}. For $n = -1$, the procedure corresponds to the AK algorithm, which compares the inverse square of the transverse momenta.
The AK algorithm is used extensively in LHC experiments and by the theoretical community for finding well-separated jets. The use of inverse square of the \pt as a weight in the $d_{ij}$ distances has the advantage that hard objects collect adjacent soft ones before these are clustered among themselves into harder objects, figuratively reproducing in reverse the parton fragmentation and gluon emission processes.
This property makes the algorithm independent on soft radiation preserving infrared-safety. The AK algorithm is also collinear-safe as the clustering is driven by the angular distance between two particles. Gluons emitted at small angles are picked up by the algorithm in early steps of the iteration and therefore do not affect the jet properties. Furthermore, this algorithm tends, by construction, to form almost circular jets allowing for straight-forward calibration and understanding of the detector acceptance. The behaviours of the CA and AK jet algorithms are illustrated in Fig,~\ref{fig:jetalgos}. 
%This algorithm is collinear-safe as the clustering is driven by the angular distance between two particles. Gluons emitted at small angles are picked up by the algorithm in early steps of the iteration and therefore do not affect the jet properties. The algorithm is also infrared-safe. Due to the weighting with the inverse maximum squared transverse momentum, the emission of additional low energy gluons are picked up rather late in the clustering process. They are picked up after all hard emissions at small angles, but, importantly, before two soft particles can cluster with each other. Soft emissions will therefore not cluster into separate jets, preserving infrared-safety.
%The AK algorithm has very good experimental properties. By construction it tends to form almost circular jets with a radius of R. This is demonstrated for an example event in Fig. 7.1. Only if two jets are closer than 2R, the shape of the two jets varies from being circular. Experimentally this feature is very important as it allows straight-forward calibration and un- derstanding of the detector acceptance. Due to its limited cone size, the measurement of jets can be restricted to active detector regions. Due to the fixed cone size, the number of detector cells to be clustered into a jet is constant over certain detector regions and therefore straight-forward to calibrate.

\begin{figure}[!htb]
\centering
\subfigure[]{\label{fig:jetalgos_a}\includegraphics[width=0.4\textwidth]{\chsix/herwig-parton-level-ev-antikt-R1p0-ghosted4root.pdf}}
\subfigure[]{\label{fig:jetalgos_b}\includegraphics[width=0.4\textwidth]{\chsix/herwig-parton-level-ev-cam-R1p0-ghosted4root.pdf}}
\caption{An example of jet clustering with the AK (a) and CA (b) algorithms. The reconstructed jets are shown as colored regions~\cite{Cacciari:2008gp}.}
\label{fig:jetalgos}
\end{figure}

The choice of the distance parameters $R$, generally depends on the analysis. While large cone size jets collect all energy from the scattered parton, they also pick up a large contribution of background energy from the underlying event or pileup interactions. Small cone size jets pick up little contamination, but may not collect all energy from the scattered parton. 
The default choice in CMS for physics analyses at 8 and 13 TeV uses the KT algorithm with $R$ = 0.5 (AK5) and $R$ = 0.4 (AK4), respectively, since more collimated jets are expected at higher $\sqrt{s}$.
However, a larger value of $R$ increases the efficiency to entirely reconstruct the highly energetic products from boosted V$\rightarrow\qqbarpr$ and H$\rightarrow\bbbar$ decays. In fact, the average angular distance between the decay products is inversely proportional to the \pt of the mother particle. The default choice in CMS for physics analyses involving boosted V or H bosons decaying hadronically is $R = 0.8$. In particular, CA8 and AK8 jets are used in the 8 and 13\TeV analyses, respectively. The chosen value of $R$ provides a high efficiency for V or H bosons with small boost and ensures that no efficiency is lost in the transition from classical V or H reconstruction in two small jets at low V or H \pt and reconstruction from a single large-cone jet at higher V or H \pt. Another point to consider when choosing the value of $R$, is the \ttbar data sample available for validating highly boosted V/H jets (see Section~\ref{sec:vtagging}). If $R$ is chosen too large, the b quark from the t$\rightarrow$Wb decay tends to merge into the W jet. The chosen value of $R$ is the result of a compromise between high efficiency for V/H bosons with small boost and a sufficiently large sample of W jets in \ttbar data for validating the  or H jet identification algorithms. Figure~\ref{fig:ca8effVsPt} shows the \pt range of W bosons for which the CA8 algorithm is efficient and compares this to the efficiency for reconstructing W bosons from two AK5 jets. Above a \pt of 200\GeV, the CA8 jet algorithm, used to identify W jets, becomes more efficient than the reconstruction of a W boson from two AK5 jets.

The AK5 or AK4 algorithms are used in this analysis to put requirements on additional b jets in the event selection (see Chapter~\ref{ch:finalselection}), along with the b tagging algorithm described in Section~\ref{subsec:bjets}.

\begin{figure}[!htb]
 \begin{center}
  \includegraphics[width=0.5\textwidth]{\chsix/ca8effVsPt.pdf}
 \end{center}
 \caption{Efficiency to reconstruct a CA8 jet within $\Delta R <$ 0.1 of a generated W boson, and the efficiency to reconstruct two AK5 jets within $\Delta R <$ 0.1 of the generated quarks W bosons, as a function of the \pt of the W boson~\cite{Khachatryan:2014vla}.}
 \label{fig:ca8effVsPt}
\end{figure}

%%%%%%%% 
\subsection{Jet reconstruction and calibration}\label{subsec:jetsreco} %https://twiki.cern.ch/twiki/bin/view/CMSPublic/PhysicsResultsJME
%%%%%%%%

In CMS several standard methods for jet reconstruction are available which make use of different detector components, e.g. the tracker and the calorimeters, and give different reconstructed objects as input to the above explained jet clustering algorithms. In this work, only jet reconstructed with the particle-flow (PF) algorithm~\cite{CMS-PAS-PFT-10-001,CMS-PAS-PFT-09-001} are used and referred to as ``PFJets''.
%The so-called CaloJets are clustered from the energy measured in the electromagnetic and hadronic calorimeters (ECAL and HCAL) combined into towers. Jets can also be clustered from reconstructed charged particle tracks (TrackJets) or with the JetsPlusTracks (JPT) method [79] which combines reconstructed CaloJets with the information of the reconstructed tracks.
As sketched in Fig.~\ref{fig:PFalgo}, the PF algorithm aims at reconstructing all the stable particles produced in an event, combining the information coming from all CMS sub-detectors to optimize particle identification, direction and energy determination. These particles are classified in several types: charged hadrons, photons, neutral hadrons, electrons and muons. As shown in Fig.~\ref{fig:PFjet_composition}, jets are typically composed by 65\% charged hadrons, 25\% photons, 10\% neutral hadrons. The PF algorithm is optimized to identify all these different components inside the jet, contrary to a calorimetric-only reconstruction. Typically, photons correspond to ECAL deposits not compatible with a tracker track. Charged hadrons correspond to HCAL and/or ECAL deposits matched to a inner track and not compatible with an electron, whereas neutral hadrons are identified as HCAL deposits not matched to any track.
%Particle trajectories measured in the tracker are extrapolated through the detector volume and are matched to the energy deposits in the calorimeters.
While the momentum of neutral particles is measured in the calorimeters, the momentum of charged particles is measured by the tracker with a better resolution. In this way both the position and energy measurements are greatly improved with respect to calorimeter jets as this algorithm makes use of the tracking detectors and high granularity of the ECAL which is much higher than that of the HCAL.
Once all the PF candidates in the event are reconstructed, they are used as input to the jet clustering algorithms and a PF jet is formed.

\begin{figure}[!htb]
 \begin{center}
  \includegraphics[width=0.7\textwidth]{\chsix/cms_particle_flow.png}
 \end{center}
 \caption{Sketch of the CMS particle-flow algorithm.}
 \label{fig:PFalgo}
\end{figure}

\begin{figure}[!htb]
\centering
\subfigure[]{\label{fig:PFjet_composition_a}\includegraphics[width=0.4\textwidth]{\chsix/pfjet-composition-pt.pdf}}
\subfigure[]{\label{fig:PFjet_composition_b}\includegraphics[width=0.4\textwidth]{\chsix/pfjet-composition-eta.pdf}}
\caption{PF jet composition in data and simulation versus \pt for jets with $|\eta| < 1.3$ (a), and versus $\eta$ at $56 < \pt < 74\GeV$ (b)~\cite{Khachatryan:2016kdb}.}
\label{fig:PFjet_composition}
\end{figure}

The jet momentum is determined as the vectorial sum of all PF candidates in the formed jet giving its ``raw'' estimate. At this stage, the reconstructed jet energy has a great uncertainty due to the several intrinsic limitations of the system, such as the non-linear response of the calorimeters, the detector segmentation, the presence of material in front of calorimeters, electronic noise, pileup. The raw jet energy and resolution are thus corrected for several factors in order to obtain the energy value as close as possible to the true energy of the initial parton. CMS has adopted a factorized approach~\cite{1748-0221-6-11-P11002} to the problem of jet energy corrections, where each level of correction takes care of a different effects as described in the following.

The first step in this approach is a correction to the jet energies to mitigate pileup effects. The additional pp collisions occurring within the same bunch-crossing as the primary hard interaction produce additional tracks in the tracker and deposit energy in the calorimeters. This contribution is usually referred to as in-time pileup. Due to the finite signal decay time in the calorimeters, the pp collisions occurring in the previous and subsequent beam crossings also contribute to calorimetric energy in the same time window as the primary hard interaction. This contribution is called out-of-time pileup.
The out-of-time contribution is mitigated at the level of signal processing, while the in-time one is partially removed using tracking information. This is achieved identifying which vertex the charged PF candidates originate from, and removing those unambiguously associated with pileup vertices before clustering jets and \ptvecmiss (see Section~\ref{sec:met}). This method is referred to as {\it charged-hadron subtraction} (CHS), and represents the reference bench- mark for jet reconstruction in Run 1 and early Run 2 analyses. For the second part of Run 2, other pileup mitigation techniques in addition to CHS have been developed and tested in CMS~\cite{CMS-PAS-JME-13-005,CMS-PAS-JME-14-001,JME-16-003} but they are not used in the analyses presented in this work. 
The CHS jets are then corrected to subtract residual contributions from neutral pileup particles, overlapping inside the jet cone. These corrections are determined from the simulation of a sample of QCD dijet events processed with and without pileup contaminations. This correction is usually parametrized as a function of the pileup energy density ($\rho$)~\cite{Cacciari:2011ma,Cacciari:2005hq}, the jet area (A)~\cite{Cacciari:2007fd}, jet \pt and $\eta$. The pileup offset corrections, defined as the mean value of the difference between the \pt of the reconstructed jet in events with and without pileup contamination, for the AK5 CHS jets as a function of the corrected jet \pt and $\eta$ are shown in Fig.~\ref{fig:pucorr_ak5chs}, estimated for typical 2012 (8 TeV) conditions with an average number of additional pileup interactions $\left\langle\mu\right\rangle$ = 20.
The typical offset correction for a AK5 jet without CHS is 0.75 for a corrected jet \pt of 30\GeV, while a correction of 0.85 is obtained for AK5 CHS jets with same \pt value. This indicates that CHS removes approximately half of this offset before jet clustering by matching tracks to pileup vertices, reducing the residual offset correction. Roughly one third of the remaining pileup is from PF charged hadrons that have not been matched to good pileup vertices, and much of the rest is from PF photons. 

\begin{figure}[!htb]
\centering
\subfigure[]{\label{fig:pucorr_ak5chs_a}\includegraphics[width=0.38\textwidth]{\chsix/pu-corr-ak5chs-pt.pdf}}
\subfigure[]{\label{fig:pucorr_ak5chs_b}\includegraphics[width=0.38\textwidth]{\chsix/pu-corr-ak5chs-eta.pdf}}
\caption{Pileup offset correction for AK5 CHS jets, with systematic uncertainty band, estimated for the typical 2012 condition of $\left\langle\mu\right\rangle$ = 20. Corrections are shown for jets at $|\eta| = 0$ versus corrected jet \pt (a), and for jets with \pt = 30\GeV versus $|\eta|$ (b)~\cite{Khachatryan:2016kdb}.}
\label{fig:pucorr_ak5chs}
\end{figure}

Secondly, a simulation driven jet energy response correction is applied. The detector simulation takes into account effects of particles deflected by the magnetic field, energy lost when traversing the detector material, particle conversions, and a detailed detector geometry. In this step the aim is to correct for non-uniformities in the different CMS sub-detectors, by comparing the reconstructed jet \pt to the particle-level one using simulated events only. The corrections are derived as a function of jet \pt and $\eta$ and make the response uniform over these two variables. The simulated particle response corrections are summarized in Fig.~\ref{fig:MCcorr_ak5chs} for data collected at 8 TeV. The response is quite flat at $\pt > 50\GeV$, where the competing effects of increasing calorimeter response and falling tracking efficiency within the jet core compensate each other. In the barrel and endcap regions, the corrections rise with $|\eta|$, due to the increasing amount of material located in front of the calorimeters, which leads to effects such as an increased rate of nuclear interactions in the tracker. The corrections are higher around $|\eta|$ = 1.3 and 3.0 due to the degradation of the response in the transition regions.

\begin{figure}[!htb]
\centering
\subfigure[]{\label{fig:MCcorr_ak5chs_a}\includegraphics[width=0.38\textwidth]{\chsix/mc-corr-ak5chs-pt.pdf}}
\subfigure[]{\label{fig:MCcorr_ak5chs_b}\includegraphics[width=0.38\textwidth]{\chsix/mc-corr-ak5chs-eta.pdf}}
\caption{Response correction factors with their systematic uncertainty band from simulation for the 2012 data collected at 8 TeV for AK5 CHS jets. Corrections are shown for jets at $|\eta| = 0$ versus corrected jet \pt (a), and for jets with \pt = 30\GeV versus $|\eta|$ (b)~\cite{Khachatryan:2016kdb}.}
\label{fig:MCcorr_ak5chs}
\end{figure}

Finally data-driven residual corrections are applied to correct for any measurable difference between the detector simulation and the jets measured in data. 
%This correction is done in two steps: first, the calibration as a function of jet $\eta$, and second, as a function of $\pt$.
This correction is done in two steps. At first, an additional correction for the non homogeneous response of the detector with $\eta$ is derived from dijet events, in which the \pt response of a probe jet, outside the barrel region, is balanced to the one in the reference tag region ($|\eta| < 1.3$) as a function of the average \pt of the dijet system. Only events with back-to-back dijets and little additional activity in the event are used, to avoid any impact from unbalanced events. %The result of the \pt-dependent fit is shown in Fig.~\ref{fig:rescorr_ak5chs_a}.
The jet energy is calibrated as a function of transverse momentum using a combination of Z($\rightarrow\ell\ell$)+jet, $\gamma$+jet, and multijet events for jets in the reference barrel region ($|\eta| < 1.3$). The basic idea, in all the considered topologies, is to exploit the transverse momentum balance between the jet to be calibrated and a well reconstructed and calibrated reference object (Z or $\gamma$). The jet energy response is studied using two approaches. In one method the jet response is evaluated by comparing the reconstructed jet momentum ($p_\mathrm{T,jet}$) directly to the momentum of the reference object ($p_\mathrm{T,ref}$), while the second, more advanced, method takes into account the \Etmiss measured in the calorimeters to balance the reference object and jet momenta. In this method the additional event activity is taken into account by the \Etmiss. Therefore, additional jets in the event have only a small impact on the measurement. The residual corrections are summarized in Fig.~\ref{fig:rescorr_ak5chs} for data collected at 8 TeV. The residual response corrections are less than 3\% in the barrel, less than 10\% in the endcaps, and about 10\% in the forward detector.

\begin{figure}[!htb]
\centering
\subfigure[]{\label{fig:rescorr_ak5chs_a}\includegraphics[width=0.38\textwidth]{\chsix/res-corr-ak5chs-pt.pdf}}
\subfigure[]{\label{fig:rescorr_ak5chs_b}\includegraphics[width=0.38\textwidth]{\chsix/res-corr-ak5chs-eta.pdf}}
\caption{Residual data/simulation response correction factors for the 2012 data collected at 8 TeV for AK5 CHS jets. Corrections are shown for jets at $|\eta| = 0$ versus corrected jet \pt (a), and for jets with \pt = 30\GeV versus $|\eta|$ (b)~\cite{Khachatryan:2016kdb}.}
\label{fig:rescorr_ak5chs}
\end{figure}

The fully calibrated PF jets are finally obtained in both data and simulation by multiplying all the above correction factors to the raw jet \pt as follows:

\begin{equation}
p_\mathrm{T,corr} = p_\mathrm{T,raw} \times C_\mathrm{pu}(p_\mathrm{T,raw},\eta,\rho,\mathrm{A}) \times C_\mathrm{sim}(C_\mathrm{pu} \cdot p_\mathrm{T,raw},\eta) \times C_\mathrm{res}(C_\mathrm{pu} \cdot C_\mathrm{sim} \cdot p_\mathrm{T,raw},\eta)
\end{equation}

where $C_\mathrm{pu}$ represents the pileup correction, $C_\mathrm{sim}$ is the simulated response correction and $C_\mathrm{res}$ is the global residual correction applied only on jets in data.
Figure~\ref{fig:jesunc813TeV} shows the overall uncertainty on the corrections to the jet energy scale for AK5 and AK4 CHS jets for data collected at 8 and 13\TeV, respectively. In both cases, the final uncertainties are below 3\% across the phase space of this analysis.

\begin{figure}[!htb]
\centering
\subfigure[]{\label{fig:jesunc_ak5chs_a}\includegraphics[width=0.38\textwidth]{\chsix/jesunc-ak5chs-pt.pdf}}
\subfigure[]{\label{fig:jesunc_ak5chs_b}\includegraphics[width=0.38\textwidth]{\chsix/jesunc-ak5chs-eta.pdf}}\\
\subfigure[]{\label{fig:jesunc_ak4chs_c}\includegraphics[width=0.38\textwidth]{\chsix/jesunc-ak4chs-pt.png}}
\subfigure[]{\label{fig:jesunc_ak4chs_d}\includegraphics[width=0.38\textwidth]{\chsix/jesunc-ak4chs-eta.png}}
\caption{Summary of jet energy scale systematic uncertainties for the 2012 data collected at 8 TeV for AK5 CHS jets (upper plots) and for the 2015 data collected at 13 TeV for AK4 CHS jets (lower plots). Uncertainties are shown for jets at $|\eta| = 0$ versus corrected jet \pt (left), and for jets with \pt = 30\GeV versus $|\eta|$ (right)~\cite{Khachatryan:2016kdb,CMS-DP-2016-020}.}
\label{fig:jesunc813TeV}
\end{figure}

The energy resolution of jets is relatively poor compared to the resolution of other physics objects (electrons, muons, photons), and the biases caused by jet resolution smearing is important for steeply falling spectra and for resonance decays. Hence, calibrations are evaluated to correct the jet energy resolution in addition to the corrections to the jet energy scale described above. The measurements are performed with methods which are extensions of the methods used for measuring jet energy scales, but instead of looking at the mean of the response distribution, the width is in the interesting parameter. Furthermore, corrections have to compensate for effects that do not produce an overall shift in the mean, but that can widen the distribution. As shown in Fig.~\ref{fig:resolcorr813TeV}, the jet energy resolution in data is worse than in the simulation by 10--20\% depending on $\eta$, and the jets in simulation need to be smeared accordingly.
%Typical jet energy resolutions at the central rapidities are 15--20\% at 30\GeV, about 10\% at 100\GeV, and 5\% at 1\TeV. 
%The total uncertainty varies between 3--8\% for $|\eta| < 2.3$, increasing toward higher rapidity.

Jets used in this analysis are also requested to pass loose identification criteria, in order to reject fake jets due to calorimeter noise, with more than 99\% efficiency for true jets. Furthermore, the AK8 (or CA8) and AK5 (or AK4) jets are required to be separated from any well-identified muon or electron (see Sections~\ref{sec:muons} and~\ref{sec:electrons}) by $\Delta R > 0.8$ and $> 0.3$, respectively. All AK8 (or CA8) and AK5 (or AK4) jets must have corrected $\pt > 30\GeV$ and $> 200\GeV$, respectively, and $|\eta| < 2.4$ to be considered in the subsequent steps of the analysis.

\begin{figure}[!htb]
\begin{center}
\subfigure[]{\label{fig:resolcorr_ak5chs_a}\includegraphics[width=0.38\textwidth]{\chsix/resolution-ak5chs-eta.pdf}}
\subfigure[]{\label{fig:resolcorr_ak4chs_b}\includegraphics[width=0.38\textwidth]{\chsix/resolution-ak4chs-eta.png}}
\end{center} 
\caption{Data/MC scale factors for the jet \pt resolution as a function of $|\eta|$ determined from 2012 data collected at 8 TeV for AK5 CHS jets (a) and from 2015 data collected at 13 TeV for AK4 CHS jets (b)~\cite{Khachatryan:2016kdb,CMS-DP-2016-020}.}
\label{fig:resolcorr813TeV}
\end{figure}

%%%%%%%% 
\subsection{Identification of b jets}\label{subsec:bjets}
%%%%%%%%
%https://twiki.cern.ch/twiki/bin/viewauth/CMS/BtagPOG
%https://twiki.cern.ch/twiki/bin/viewauth/CMS/BtagRecommendation
%https://twiki.cern.ch/twiki/bin/viewauth/CMS/BtagRecommendation74X
%https://twiki.cern.ch/twiki/bin/viewauth/CMS/BtagRecommendation53XReReco
%https://twiki.cern.ch/twiki/bin/view/CMSPublic/PhysicsResultsBTV

The identification of jets originating from b quarks (``b jets'') is one of the key ingredients of the analysis described in this work, which aims at isolating events of new physics with Higgs bosons decaying to $\bbbar$. The ability to identify b jets (``b tagging'') plays a crucial role in reducing background coming from processes involving jets from gluons and light-flavor quarks (u, d, s), and from c quark fragmentation.

Identifying b jets relies on the properties of the production and the weak decay of b hadrons. The most important property is the relatively long lifetime of b hadrons of about 1.5 ps ($c\tau \equiv 450\mu m$) corresponding to a flight distance that is observable with high resolution tracking detectors. A b hadron with \pt = 50\GeV covers, on average, almost half a centimetre ($Lc \sim \gamma\tau$) before decaying. As shown in Fig.~\ref{fig:bjet}, this leads to secondary vertices displaced from the primary event vertex and charged particle tracks incompatible with the primary vertex with sizeable impact parameter. In addition, b hadrons have a large mass and large multiplicity of charged particles in the final state (about five charged particles on average per b hadron decay). Because of the hard b-fragmentation function, the b hadron in a b jet carries a large fraction of the jet energy. Since b and c hadrons may decay semileptonically, in about 20\% (per lepton species) of the cases an electron or muon is produced inside a b jet, if both direct and cascade decays are taken into account.

\begin{figure}[!htb]
 \begin{center}
  \includegraphics[width=0.4\textwidth]{\chsix/B-tagging_diagram.png}
 \end{center}
 \caption{Representation of a b hadron decay and reconstructed b jet in the transverse plane.}
 \label{fig:bjet}
\end{figure}

A variety of algorithms has been developed in CMS~\cite{Chatrchyan:2012jua} to identify b jets based on the the b hadron properties described above. These algorithms use lower-level physics objects, mainly jets and charged tracks. Only the tracking detectors offer the spatial resolution needed to to measure the properties of b hadron decays such as their significant flight path. Efficient track reconstruction, and in particular precise spatial reconstruction close to the interaction point, is thus the key ingredient. 
Some of these algorithms use just a single observable, while others combine several of these objects to achieve a higher discrimination power. Each of these algorithms yields a single discriminator value for each jet. The minimum thresholds on these discriminators define loose (``L''), medium (``M''), and tight (``T'') operating points with a misidentification probability for light-flavor jets of 10\%, 1\%, and 0.1\%, respectively, at an average jet \pt of about 80\GeV.

The jets used for b tagging are reconstructed with the PF algorithm and calibrated as described in ~\ref{subsec:jetsreco}. A sample of well-reconstructed tracks of high purity is required as input to each of the b tagging methods. Specific requirements are imposed in addition to the selection applied in the iterative tracking procedure described in Section~\ref{subsec:tracks}:

\begin{itemize}
\item the fraction of misreconstructed or poorly reconstructed tracks is reduced by requiring a $\pt >1\GeV$;
\item at least 8 tracker hits (including pixel) must be associated with the track;
\item at least 2 hits are required in the pixel system since track measurements in the innermost layers provide most of the discriminating power;
\item the normalised $\chi^2$ is required to be $< 5$ to ensure a good-quality fit;
\item the absolute value of the transverse and longitudinal impact parameter of the track must be $<$ 0.2 and $<$ 17 cm, respectively, to reject charged particle tracks having their origin from sources showing much larger displacement from the primary vertex (e.g. photon conversions and nuclear interactions in the beam pipe or the first layers of the pixel detector);
\item tracks are associated to jets in a cone $\Delta R < 0.3$ around the jet axis, where the jet axis is defined by the primary vertex and the direction of the jet momentum\FIXME{check this for Run 2};
\item in order to reject tracks from pileup the distance to jet axis, defined as the distance of closest approach of the track to the axis, is required to be $<$ 700$\mu$m;
\item the point of closest approach between the track trajectory and the jet axis, must be within 5 cm of the primary vertex.
\end{itemize}

Two algorithms for reconstructing secondary vertices are exploited. For the first algorithm, the tracks associated to jets and fulfilling the above selection requirements are used in the adaptive vertex reconstruction (AVR) algorithm~\cite{Waltenberger:1166320} based on the adaptive vertex fitter described in Section~\ref{subsec:tracks}. This is the secondary vertex reconstruction algorithm used for b tagging methods in CMS during LHC Run 1. A number of selection criteria are applied to remove vertices that are less likely to originate from a b hadron decay. 

\begin{itemize}
\item at least 2 tracks must be associated to the secondary vertex;
\item the fraction of tracks shared with the primary vertex is required to be $<$ 65\%;
\item the distance between the primary vertex to the secondary vertex in the transverse plane, the 2D flight distance, must be in the range 0.1--25 mm;
\item the 2D flight distance divided by its uncertainty or so-called 2D flight distance significance has to be $>$ 3;
\item the invariant mass of charged particles associated to the vertex is required to be $<$ 6.5\GeV and not compatible with the mass of the K$^0_S$ hadron in a window of 50\MeV;
\item the angular distance $\Delta R$ between the jet axis and the secondary vertex flight direction is required to be less than the jet distance parameter;
\end{itemize}

In contrast with the AVR algorithm, the Inclusive Vertex Finder (IVF)~\cite{Khachatryan:2011wq}, is not seeded from tracks associated to the reconstructed jets. The IVF algorithm uses as input the collection of reconstructed tracks in the event and looser quality criteria are applied. The selected tracks are then used to identify clusters of nearby tracks based on their minimum distance and the angles between them. The clusters are fitted with the adaptive vertex fitter and a cleaning procedure is applied. At this stage, tracks can appear in multiple vertices and therefore, one of the vertices is removed based on the number of shared tracks and distance between the vertex and another one. Furthermore, tracks in the secondary vertex compatible with the primary vertex are removed. When there are at least 2 tracks associated to the secondary vertex after the track arbitration, the vertex is refitted and selection criteria similar to the case of the AVR vertices are applied.

 The efficiency to reconstruct a secondary vertex for b (c) jets using the IVF algorithm is about 10\% (15\%) higher compared to the efficiency to reconstruct a secondary vertex with the AVR algorithm. However, for light-flavour jets the probability to find a secondary vertex also increases by about 8\%. Independently of the jet flavour, around 60\% of the jets with an AVR vertex also have an IVF vertex.
 
In this analysis the {\itshape Combined Secondary Vertex} (CSV) algorithm is used, which combines the information of displaced tracks with the information of secondary vertices associated to the jet.
%The CSV algorithm was further optimized and the new version is referred to as CSVv2 and it uses IVF.
This allows the algorithm to avoid limitations due to inefficiencies in the secondary vertex reconstruction. Jets are divided in three vertex-dependent exclusive categories: the presence of a reconstructed secondary vertex; at least two tracks with impact parameter significance larger than 2; none of the previous. The following set of variables with high discriminating power and low correlations are considered:

\begin{itemize}
\item the secondary vertex category;
\item the 2D flight distance significance of the secondary vertex;\item the number of tracks in the jet\item the number of tracks associated to the secondary vertex;\item the secondary vertex mass;\item the ratio of the energy carried by tracks at the vertex with respect to all tracks in the jet;\item the $\eta$ of the tracks at the vertex with respect to the jet axis;\item the 2D impact parameter significance of the first track that raises the invariant mass above the charm threshold of 1.5\GeV when subsequently summing up tracks ordered by decreasing impact parameter significance;\item the 3D signed impact parameter significance for each track in the jet.
\end{itemize}

Two likelihood ratios are built from these variables used to discriminate between b and c jets and between b and light-flavor jets and combined with prior weights of 0.25 and 0.75, respectively. Figure~\ref{fig:csv_813TeV_a} shows the distribution of the CSV discriminator value in a multijet sample for data collected at 8\TeV and for simulation, for jets reconstructed with the AK5 algorithm.

\begin{figure}[!htb]
\begin{center}
\subfigure[]{\label{fig:csv_813TeV_a}\includegraphics[width=0.45\textwidth]{\chsix/CSV-multijet-run1.pdf}}
\subfigure[]{\label{fig:csv_813TeV_b}\includegraphics[width=0.45\textwidth]{\chsix/CSVv2-multijet-run2.pdf}}
\end{center} 
\caption{(a) Distribution of the CSV discriminator value in a multijet sample for data collected at 8\TeV and for simulation~\cite{CMS:BTV13001}, for jets reconstructed with the AK5 algorithm. (b) Distribution of the CSVv2 discriminator value in a multijet sample for data collected at 13\TeV and for simulation, for jets reconstructed with the AK4 algorithm~\cite{CMS-PAS-BTV-15-001}.}
\label{fig:csv_813TeV}
\end{figure}

The CSV algorithm was further optimized for LHC Run 2 and the new version is referred to as CSV version 2 (CSVv2)~\cite{CMS-PAS-BTV-15-001}. The main differences with the Run 1 version of the CSV algorithm are the different vertex reconstruction algorithm used, the number of input variables and the way those are combined. In this version the input variables are combined using a multivariate technique. In fact, the likelihood-based method used in Run 1 limited the amount of input variables since correlation between those could not be taken into account properly. In addition, the secondary vertex information is obtained with the IVF method described above. Figure~\ref{fig:csv_813TeV_b} shows the distribution of the CSVv2 discriminator value in a multijet sample for data collected at 13\TeV and for simulation, for jets reconstructed with the AK4 algorithm.

The performance of the CSVv2 tagger is presented in Fig.~\ref{fig:btagalgo} as the b jet identification efficiency versus the misidentification probability for jets in simulated \ttbar events requiring a jet $\pt > 30\GeV$. A comparison is shown with the Run 1 version of the CSV algorithm, without retraining this algorithm. The CSV algorithm was trained on 7\TeV pp collisions using AK5 jets. The absolute improvement of the CSVv2 (AVR) algorithm with respect to the CSV algorithm is of the order of 2 to 4\% in b jet identification efficiency when comparing at the same misidentification probability for light-flavour jets. The improvement of using IVF vertices with respect to using AVR vertices in the CSVv2 algorithm is of the order of 1 to 2\%. For light-flavour jets, the absolute efficiency improves by about 4\% with respect to the CSVv2 algorithm.

The value of the discriminator threshold for each algorithm and the corresponding efficiencies are summarized in Table~\ref{tab:btagwp}.

\begin{figure}[!htb]
 \begin{center}
  \includegraphics[width=0.45\textwidth]{\chsix/btagalgo-ak4jets.pdf}
 \end{center}
 \caption{Performance of the CSVv2 algorithm demonstrating the probability for non-b jets to be misidentified as b jet as a function of the efficiency to correctly identify b jets. The improvement of this algorithm with respect to the Run 1 version of the algorithm is also shown~\cite{CMS-PAS-BTV-15-001}.}
 \label{fig:btagalgo}
\end{figure}

\begin{table}[!htb]
\centering
\caption{Taggers, discriminator threshold for Run 1 and Run 2 and corresponding efficiency for b jets with $\pt > 30\GeV$ in simulated \ttbar events.}
\resizebox{\textwidth}{!}{
\begin{tabular}{ l | c | c | c}
Algorithm & operating point & discriminator value & b tagging efficiency (\%)\\ 
\hline
\hline
\multirow{3}{*}{CSV (Run 1)} & CSVL & 0.244 & 84\\
 & CSVM & 0.679 &  68\\
 & CSVT & 0.898 & 52\\
\multirow{3}{*}{CSVv2 (Run 2)} & CSVv2L & 0.460 & 83\\
 & CSVv2M & 0.800 & 69\\
 & CSVvsT & 0.935 & 49\\
\end{tabular}}
\label{tab:btagwp}
\end{table}
